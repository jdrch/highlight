<!DOCTYPE html>
<head>
    <style>
        html {
            color-scheme: light dark;
        }
        html, body {
            width: 100%;
            height: 100%;
        }
        body {
            display: flex;
            flex-direction: column;
            margin: 0;
        }
        iframe {
            flex: 1;
            width: 100%;
            border: 0;
            background: transparent;
            color-scheme: auto;
        }
    </style>

    <script>
        let iframe
        let highlights = [
            {
                _id: 'asdas9329',
                text: `Мы относим себя к представителям верхнего среднего класса. По моим оценкам, средний класс в столице начинается от 300 000 Р в месяц на семью с ребенком. С таким доходом можно позволить себе покупку нормального собственного жилья, хороший автомобиль, обучение и воспитание детей.`,
                note: 'some note',
                color: 'blue'
            }
        ]

        window.addEventListener('message', ({data, source}) => {
            if (typeof data != 'object' || !data.type) return
            const { type, payload } = data
            switch(type) {
                case 'RDH_READY':
                    iframe = source
                    iframe.postMessage({
                        type: 'RDH_CONFIG',
                        payload: {
                            enabled: true,
                            nav: true,
                            pro: true
                        }
                    }, '*')
                    iframe.postMessage({
                        type: 'RDH_APPLY',
                        payload: highlights
                    }, '*')
                break

                case 'RDH_UPDATE':
                    let i = highlights.findIndex(({ _id }) => _id == payload._id)
                    if (i != -1){
                        for(const [key,val] of Object.entries(payload))
                            highlights[i][key] = val
                    }

                    iframe.postMessage({
                        type: 'RDH_APPLY',
                        payload: highlights
                    }, '*')
                break

                case 'RDH_REMOVE':
                    highlights = highlights.filter(({ _id }) => _id != payload._id)
                    iframe.postMessage({
                        type: 'RDH_APPLY',
                        payload: highlights
                    }, '*')
                break

                case 'RDH_ADD':
                    highlights.push({
                        ...payload,
                        _id: String(new Date().getTime())
                    })
                    iframe.postMessage({
                        type: 'RDH_APPLY',
                        payload: highlights
                    }, '*')
                break
            }
        })

        function scrollToLast() {
            iframe.postMessage({
                type: 'RDH_SCROLL',
                payload: {
                    _id: highlights[highlights.length-1]._id
                }
            }, '*')
        }
    </script>
</head>
<body>
    <div>
        <button onclick="scrollToLast()">
            Scroll to last
        </button>
    </div>
    <iframe id="iframe" src="embed.html"></iframe>
    <!-- <iframe id="iframe" src="http://127.0.0.1:8787/article/aHR0cHM6Ly90b21jcml0Y2hsb3cuY29tLzIwMjIvMDEvMjYvZWxlY3RyaWMtdGFibGVzLw==#theme=auto&solid-bg=false&font-size=1&font-family="></iframe> -->
</body>